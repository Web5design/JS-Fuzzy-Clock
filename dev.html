<!doctype html>
<html>
	<head>
    <meta charset="utf-8" />
    <title>fuzzy</title>
    </head>
	<body>
    
    <h1></h1>
    <script>
    (function (window, document, undefined) {
        
        
        var translateMinutes = {
            30: "half",
            20: "twenty",
            15: "quarter",
            10: "ten",
            5: "five",
            0: ''
            
        },
            translateHours = "twelve,one,two,three,four,five,six,seven,eight,nine,ten,eleven".split(','),
            infix = {
                past: "past",
                to: "to"
            },
            sharp = "o'clock";

        translateHours[translateHours.length] = translateHours[0];

        var fuzzy = function (date) {
            date = date || new Date;
            var minutes = date.getMinutes(), hours = date.getHours();
            var data = {
                minutes: this.understandMinutes(minutes),
                hours: this.understandHours(hours, minutes),
                infix: this.decideInfix(minutes),
                suffix: this.decideSuffix(minutes),
            };
            var pattern = this.decidePattern(data);
            this.data = data;
            this.string = this.interpolate(pattern, data);
        };

        fuzzy.prototype.understandMinutes = function (minutes) {
            if( minutes > 30 ) {
                minutes = 60 - minutes;
            }
            var i = 0, key, keys = [30, 20, 15, 10, 5, 0], l = keys.length;
            for(; i < l && minutes < keys[i]; i++);
            return translateMinutes[keys[i]];
        };

        fuzzy.prototype.understandHours = function (hours, minutes) {
            return translateHours[ (hours + (minutes > 30 ? 1 : 0) ) % 12 ];
        };

        fuzzy.prototype.decideInfix = function (minutes) {
            return infix[ minutes > 30 ? 'to' : 'past' ];
        };

        fuzzy.prototype.decideSuffix = function (minutes) {
            return minutes > 55 || minutes < 4 ? sharp : '';
        };

        fuzzy.prototype.decidePattern = function (data) {
            console.log(data);
            return data.minutes? '{minutes} {infix} {hours}' : '{hours} {suffix}';
        };

        fuzzy.prototype.interpolate = function (pattern, data) {
            console.log(pattern);
            for( var i in data ){
                console.log(data[i]);
                pattern = pattern.replace('{' + i + '}', data[i]);
            }
            return pattern;
        };


        

        window.fuzzy = fuzzy;




    }(window, document));

    document.addEventListener('DOMContentLoaded', function (ev) {
        console.log(new fuzzy().string);
    }, false);
    
    
    </script>

    </body>
</html>
